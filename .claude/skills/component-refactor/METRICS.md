# Component Complexity Metrics

React Nativeコンポーネントの複雑度を測定するメトリクス定義

## 1. サイズメトリクス

### 行数（Lines of Code）
- **測定方法**: コンポーネントファイルの総行数（コメント・空行含む）
- **評価基準**:
  - ✅ **良好**: 0-200行
  - ⚠️ **警告**: 200-400行
  - 🔴 **要改善**: 400行以上

### 関数数
- **測定方法**: コンポーネント内で定義されている関数の数
- **評価基準**:
  - ✅ **良好**: 0-10個
  - ⚠️ **警告**: 10-20個
  - 🔴 **要改善**: 20個以上

## 2. Stateメトリクス

### useState数
- **測定方法**: `useState` フックの使用回数
- **評価基準**:
  - ✅ **良好**: 0-5個
  - ⚠️ **警告**: 5-10個
  - 🔴 **要改善**: 10個以上

### useReducer複雑度
- **測定方法**: `useReducer` のaction typeの数
- **評価基準**:
  - ✅ **良好**: 0-5個
  - ⚠️ **警告**: 5-10個
  - 🔴 **要改善**: 10個以上

## 3. Effectメトリクス

### useEffect数
- **測定方法**: `useEffect` フックの使用回数
- **評価基準**:
  - ✅ **良好**: 0-5個
  - ⚠️ **警告**: 5-10個
  - 🔴 **要改善**: 10個以上

### 依存配列の長さ（平均）
- **測定方法**: 全てのuseEffectの依存配列の要素数の平均
- **評価基準**:
  - ✅ **良好**: 0-3個
  - ⚠️ **警告**: 3-5個
  - 🔴 **要改善**: 5個以上

## 4. Propsメトリクス

### Props数
- **測定方法**: コンポーネントが受け取るpropsの数
- **評価基準**:
  - ✅ **良好**: 0-10個
  - ⚠️ **警告**: 10-15個
  - 🔴 **要改善**: 15個以上

### Propsドリリング深さ
- **測定方法**: 同じpropが何階層渡されているか
- **評価基準**:
  - ✅ **良好**: 0-2階層
  - ⚠️ **警告**: 2-3階層
  - 🔴 **要改善**: 3階層以上

## 5. 構造メトリクス

### JSXネスト深さ（最大）
- **測定方法**: JSX要素の最大ネスト階層数
- **評価基準**:
  - ✅ **良好**: 0-4階層
  - ⚠️ **警告**: 4-6階層
  - 🔴 **要改善**: 6階層以上

### 子コンポーネント数
- **測定方法**: コンポーネント内でレンダリングされる子コンポーネントの種類数
- **評価基準**:
  - ✅ **良好**: 0-10個
  - ⚠️ **警告**: 10-20個
  - 🔴 **要改善**: 20個以上

## 6. 条件分岐メトリクス

### 条件分岐数（Cyclomatic Complexity）
- **測定方法**: `if`, `switch`, `? :`, `&&`, `||` の数
- **評価基準**:
  - ✅ **良好**: 0-10個
  - ⚠️ **警告**: 10-20個
  - 🔴 **要改善**: 20個以上

### JSX内の三項演算子数
- **測定方法**: JSX内の `? :` の数
- **評価基準**:
  - ✅ **良好**: 0-3個
  - ⚠️ **警告**: 3-5個
  - 🔴 **要改善**: 5個以上

## 7. パフォーマンスメトリクス

### useMemo/useCallback使用率
- **測定方法**: (useMemo + useCallback数) / (関数数 + 計算処理数)
- **評価基準**:
  - ✅ **良好**: 50%以上
  - ⚠️ **警告**: 30-50%
  - 🔴 **要改善**: 30%未満

### React.memo使用
- **測定方法**: React.memoでラップされているか
- **評価基準**:
  - ✅ **良好**: 使用している（propsが頻繁に変わる場合）
  - ⚠️ **警告**: 使用していないが、使うべき
  - 🔴 **要改善**: 不要なのに使っている

## 8. 可読性メトリクス

### コメント率
- **測定方法**: コメント行数 / 総行数
- **評価基準**:
  - ✅ **良好**: 10-30%
  - ⚠️ **警告**: 5-10% または 30-50%
  - 🔴 **要改善**: 5%未満 または 50%以上

### 変数名の長さ（平均）
- **測定方法**: 変数名の文字数の平均
- **評価基準**:
  - ✅ **良好**: 10-20文字
  - ⚠️ **警告**: 5-10文字 または 20-30文字
  - 🔴 **要改善**: 5文字未満 または 30文字以上

## 総合スコア計算

各メトリクスをポイント化して総合スコアを計算:

- ✅ 良好: +3ポイント
- ⚠️ 警告: +1ポイント
- 🔴 要改善: -1ポイント

**総合評価**:
- **80ポイント以上**: 優秀 - リファクタリング不要
- **60-80ポイント**: 良好 - 軽微な改善推奨
- **40-60ポイント**: 普通 - リファクタリング推奨
- **20-40ポイント**: 不良 - リファクタリング必須
- **20ポイント未満**: 危険 - 即座にリファクタリング

## Lingoooプロジェクトでの実例

### 良い例: `QACard.tsx`
```
行数: 150行 (✅)
useState: 2個 (✅)
useEffect: 1個 (✅)
Props: 8個 (✅)
ネスト深さ: 3階層 (✅)

総合スコア: 15ポイント (優秀)
```

### 改善が必要な例: `word-detail.tsx`
```
行数: 1460行 (🔴)
useState: 15個 (🔴)
useEffect: 8個 (🔴)
Props: 12個 (⚠️)
ネスト深さ: 5階層 (⚠️)

総合スコア: -5ポイント (危険)
リファクタリング提案:
1. モーダル管理ロジックをカスタムフックに抽出
2. 翻訳セクションを別コンポーネントに分割
3. ブックマーク管理ロジックをカスタムフックに抽出
```
