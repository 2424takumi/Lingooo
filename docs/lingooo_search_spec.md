# 🔍 Lingooo 検索機能 要件定義 & 開発計画書

（MVP版 / 2025年11月）

---

## 1. 機能概要

### 🎯 目的
AIを補助にした「辞書＋探究」の新しい検索体験を提供する。  
単語の意味・ニュアンス・比較を1秒で理解できることを目指す。

### 🌱 コア体験
- 日本語・英語など多言語に対応した**自動判定検索**
- 辞書情報（短義・例文・コロケーション）＋AIによる文脈解釈
- 検索結果をすぐに深掘りできるUI（IntentBar）

---

## 2. 機能要件

### 2.1 入力・前処理
| 項目 | 内容 |
|------|------|
| 入力形式 | テキスト（最大128文字） |
| 前処理 | 空白・大文字小文字・全半角・ダイアクリ除去 |
| 言語判定 | CLD3相当 or 文字種ヒューリスティック＋辞書ヒット率 |
| タイポ補正 | 編集距離 ≤ 1、候補提示 |

---

### 2.2 検索分岐
| 条件 | 遷移ページ | 内容 |
|------|-------------|------|
| 入力が日本語 | **JpSearchPage** | 日本語→外国語候補一覧 |
| 入力が外国語 | **WordDetailPage** | 単語の意味・例文・コロケ表示 |

---

### 2.3 出力構造
#### 日本語検索結果（候補リスト）
```json
{
  "items": [
    { "lemma": "study", "pos": ["noun","verb"], "shortSenseJa": "学ぶ・研究する", "confidence": 0.92 }
  ]
}
```
- 表示最大10件、スコア順にソート
- スコア要素：対訳頻度／品詞一致／意味類似度／クリック履歴Prior

#### 外国語詳細結果
```json
{
  "headword": { "lemma": "study", "lang": "en", "pos": ["noun","verb"] },
  "senses": [{ "id": "v1", "glossShort": "学ぶ・研究する" }],
  "example": { "textSrc": "She studied hard.", "textDst": "彼女は一生懸命勉強した。" },
  "collocations": [{ "phrase": "study hard" }, { "phrase": "study abroad" }],
  "hint": { "text": "studyは過程、learnは結果に焦点。" }
}
```

---

### 2.4 検索ロジック構造
1. 正規化（normalize）
2. 言語判定（detectLang）
3. 検索分岐（ja→suggest / en→entry）
4. ローカル辞書検索（Lite版SQLite or JSON）
5. サーバ辞書補完（任意）
6. キャッシュ結果返却（L1メモリ / L2端末）

---

### 2.5 パフォーマンス要件（SLO）

| 操作 | p95目標 | 備考 |
|------|----------|------|
| 候補表示（日本語検索） | ≤ 300ms | 10件以内 |
| 詳細表示（英語検索） | ≤ 1000ms | オフラインでも可 |
| AI要約応答 | ≤ 1500ms | 非ブロッキング |
| 1秒即答率 | ≥ 80% | 検索→短義表示 |

---

### 2.6 キャッシュ仕様

| レイヤ | 内容 |
|--------|------|
| L1メモリ | 直近10語、TTL10分 |
| L2端末 | AsyncStorage、LRU200語 |
| プリフェッチ | 日本語検索1位候補を事前取得 |

---

### 2.7 AI補助（Intent API）

| IntentID | 内容 |
|-----------|------|
| `nature` | 自然さの確認（使い方が自然？） |
| `abComparison` | A/Bの違い（例：study vs learn） |
| `politeness` | 丁寧さ・トーン分析 |
| `paraphrase` | 言い換え提案 |
| `moreExamples` | 追加例文提示 |

- エンドポイント：`POST /api/intent`
- 返却：`{ summary, hint? }`
- タイムアウト：3秒

---

### 2.8 エッジケース
- タイポ → 自動補正候補提示
- 同形異義 → posタブ切替
- 未ヒット → 近似候補3件＋AI短義
- オフライン → Lite辞書のみ（AI非活性）

---

## 3. 開発計画（ToDo）

### 0) 基盤構築（Day 0–1）
- [ ] Expo/TypeScript/NativeWind 初期化  
- [ ] 3ページ雛形（HomePage, JpSearchPage, WordDetailPage）  
- [ ] Zustand 導入  
- [ ] コンポーネントスケルトン作成（HeaderBar / SearchBar / SuggestionCard）  

### 1) 検索コア（Day 2–3）
- [ ] 正規化関数 `normalizeQuery`  
- [ ] 言語判定 `detectLang`  
- [ ] ローカルLite辞書導入（JSON or SQLite）  
- [ ] タイポ補正・前方一致検索  

### 2) 日本語→候補リスト（Day 3–4）
- [ ] `/api/suggest` スタブ  
- [ ] ランキングロジック実装  
- [ ] UI: SuggestionList / SuggestionCard（10件）  
- [ ] 先読み機能  

### 3) 外国語→詳細（Day 4–6）
- [ ] `/api/entry` スタブ  
- [ ] 表示構成：短義×2 + 例文 + コロケ×3 + ヒント  
- [ ] 同形異義タブ  
- [ ] PronounceButton（TTS後付け）  

### 4) キャッシュ&パフォーマンス（Day 6–7）
- [ ] L1/L2 キャッシュ実装  
- [ ] 入力デバウンス 300ms  
- [ ] プリフェッチ確認  

### 5) ヘッダーVariant（Day 7）
- [ ] HeaderSearch / HeaderJapanese / HeaderResult 実装  
- [ ] 言語切替・音声ボタン連動  

### 6) AIスタブ & 本実装（Day 2〜並行 / 8–10）
- [ ] `/api/intent` スタブ  
- [ ] プロンプト雛形（intentId別）  
- [ ] OpenAI接続・エラー処理・レスポンス整形  
- [ ] 非ブロッキング化（スピナー表示）  

### 7) テレメトリ & KPI（Day 10）
- [ ] `search_submit / suggest_view / detail_view / intent_click` ログ  
- [ ] Time-to-Meaning可視化  

### 8) エッジケース対応 & QA（Day 11–12）
- [ ] 多語句・曖昧入力対応  
- [ ] オフライン動作確認  
- [ ] a11yテスト（読み上げ・フォーカス移動）  

### 9) 最終調整・リリース（Day 13–14）
- [ ] カラートーン・余白調整  
- [ ] アイコン・音声素材最終反映  
- [ ] TestFlight / 内部テストリリース  

---

## 4. 開発方針

| 項目 | 内容 |
|------|------|
| 検索ロジック | ローカル完結優先。AI依存しない構造。 |
| AI処理 | `/api/intent` 別トラック開発。スタブ先行。 |
| 主要目標 | 1秒即答率 80%以上。 |
| 品質基準 | クラッシュ0、主要ケースで破綻なし。 |
| バージョン目標 | MVP（v1.0）を1ヶ月以内に完成。 |

---

## 5. Doneの定義（DOD）
- 入力→候補：300ms以内（p95）  
- 候補→詳細：1000ms以内（p95）  
- AI要約：平均1.5秒、失敗時フォールバックあり  
- 主要エッジケース対応済  
- UX：1秒で“短義”が見えること  

---

## 6. 今後の拡張
| フェーズ | 内容 |
|-----------|------|
| v1.1 | SRS復習モード・ブックマーク |
| v1.2 | コーパス分析（KWIC/用例分布） |
| v1.3 | オフラインLite強化・Web同期 |
| v1.4 | Web版（Next.js）展開 |

---
